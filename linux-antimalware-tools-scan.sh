#!/bin/bash

# Definición de la variable que almacena la ruta con el fichero de logs
# Como ruta se ha elegido el directorio /var/log
# El nombre del fichero contendrá la fecha de ejecución en formato YYYY-MM-DD
LOGFILE="/home/scripts/logs/security-check-$(date +'%Y-%m-%d').log";

# Añadir cabecera para los resultados de ClamAV en el fichero LOGFILE
echo -e "\n********** Resultado Análisis ClamAV **********\n" >> "$LOGFILE" 

# Ejecutar escaner con ClamAV y guardar resultado en el fichero LOGFILE
# El parámetro -r sirve para escanear directorios de forma recursiva
# El parámetro -i sirve para alertar unicamente de los ficheros infectados
# El parámetro --no-summary sirve para excluir el resumen final
# En este caso, hacemos el analisis sobre el directorio /home
sudo clamscan -r -i --no-summary /home >> "$LOGFILE";

# Añadir cabecera para los resultados de Chkrootkit en el fichero LOGFILE
echo -e "\n********** Resultado Análisis Chkrootkit **********\n" >> "$LOGFILE" 

# Ejecuta escaner con Chkrootkit y guardar resultado en el fichero LOGFILE
# El parámetro -q sirve para alertar solo de los warnings 
sudo chkrootkit -q >> "$LOGDIR";

# Añadir cabecera para los resultados de Rkhunter en el fichero LOGFILE
echo -e "\n********** Resultado Análisis Rkhunter **********\n" >> "$LOGFILE" 

# Ejecuta escaner con Rkhunter y guardar resultado en el fichero LOGFILE
# El parámetro -c de Rkhunter sirve para indicar la acción de realizar un escaneo
# El parámetro -rwo de Rkhunter sirve para alertar solo de los warnings
sudo rkhunter -c -rwo >> "$LOGFILE";
